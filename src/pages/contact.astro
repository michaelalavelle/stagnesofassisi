---
import BaseLayout from "../layouts/BaseLayout.astro";
---

<BaseLayout title="Contact | St. Agnes of Assisi Fraternity">
  <section class="hero">
    <h1>Contact</h1>
    <p>
      We would love to hear from you. Please reach out to learn more or to
      arrange a visit.
    </p>
  </section>

  <section class="card" style="margin-top: 2rem;">
    <h2 class="section-title">Get in Touch</h2>
    <form
      class="contact-form"
      action="https://formspree.io/f/mgoladbv"
      method="POST"
      data-formspree
    >
      <label>
        Your Name *
        <input type="text" name="name" autocomplete="name" required aria-required="true" />
      </label>
      <label>
        Email Address *
        <input type="email" name="email" autocomplete="email" required aria-required="true" />
      </label>
      <label>
        Phone (optional)
        <input type="tel" name="phone" autocomplete="tel" />
      </label>
      <label>
        Message *
        <textarea name="message" rows="6" required aria-required="true"></textarea>
      </label>
      <button type="submit" class="button">Send Message</button>
      <p class="form-help">Fields marked with * are required.</p>
    </form>

    <div class="form-error" hidden></div>

    <div class="form-success" hidden>
      <h3>Thank You</h3>
      <p>
        Thank you for reaching out. Someone from our fraternity will get back to
        you shortly.
      </p>
    </div>
  </section>

  <script>
    const form = document.querySelector("[data-formspree]");
    const success = document.querySelector(".form-success");
    const errorBox = document.querySelector(".form-error");
    if (
      form instanceof HTMLFormElement &&
      success instanceof HTMLElement &&
      errorBox instanceof HTMLElement
    ) {
      const submitButton = form.querySelector('button[type="submit"]');
      form.addEventListener("submit", async (event) => {
        event.preventDefault();

        if (!form.checkValidity()) {
          form.reportValidity();
          return;
        }

        errorBox.hidden = true;
        errorBox.textContent = "";
        const data = new FormData(form);
        if (submitButton instanceof HTMLButtonElement) {
          submitButton.disabled = true;
          submitButton.textContent = "Sending...";
        }

        try {
          const response = await fetch(form.action, {
            method: form.method,
            body: data,
            headers: {
              Accept: "application/json",
            },
          });

          if (response.ok) {
            form.reset();
            form.hidden = true;
            success.hidden = false;
          } else {
            const body = await response.json().catch(() => null);
            const message =
              body?.errors?.[0]?.message ??
              "Sorry, there was a problem sending your message.";
            errorBox.textContent = message;
            errorBox.hidden = false;
          }
        } catch {
          errorBox.textContent =
            "Network error. Please check your connection and try again.";
          errorBox.hidden = false;
        }

        if (submitButton instanceof HTMLButtonElement) {
          submitButton.disabled = false;
          submitButton.textContent = "Send Message";
        }
      });
    }
  </script>
</BaseLayout>
